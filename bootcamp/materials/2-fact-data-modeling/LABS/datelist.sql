

WITH USERS AS (
    SELECT * FROM USERS_CUMULATED
    WHERE DATE = DATE('2023-01-31')
    ), SERIES AS (
SELECT * FROM GENERATE_SERIES(DATE('2023-01-01'), DATE('2023-01-31'), INTERVAL '1 DAY') AS SERIES_DATE

    ), PLACEHOLDER_INT AS (
SELECT
    CASE WHEN
    DATES_ACTIVE @> ARRAY[DATE(SERIES_DATE)]
    THEN	POW(2, 32- (DATE - DATE(SERIES_DATE)))
    ELSE 0
    END AS INT_VALUE,
    *
FROM USERS CROSS JOIN SERIES
    -- WHERE USER_ID = '13842127845142700000'
    )
SELECT USER_ID,
       CAST(CAST(SUM(INT_VALUE)AS BIGINT) AS BIT(32)),
       BIT_COUNT(CAST(CAST(SUM(INT_VALUE)AS BIGINT) AS BIT(32))) > 0 AS DIM_IS_MONTHLY_ACTIVE,
       BIT_COUNT( CAST('11111110000000000000000000000000' AS BIT(32))& CAST(CAST(SUM(INT_VALUE)AS BIGINT) AS BIT(32))) > 0 AS DIM_IS_WEEKLY_ACTIVE,
       BIT_COUNT( CAST('10000000000000000000000000000000' AS BIT(32))& CAST(CAST(SUM(INT_VALUE)AS BIGINT) AS BIT(32))) > 0 AS DIM_IS_DAILY_ACTIVE

FROM PLACEHOLDER_INT
GROUP BY USER_ID


